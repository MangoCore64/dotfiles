# =============================================================================
#  TMUX CONFIG: LOCAL / COCKPIT
#  Prefix: Ctrl+B
#  Theme:  Catppuccin Mocha (Primary)
# =============================================================================
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# §1. 基本設定 (General)
set-option -g prefix C-q
unbind-key C-a
bind-key C-q send-prefix

set -g base-index 1
setw -g pane-base-index 1
set -g history-limit 10000
set -g mouse on
setw -g mode-keys vi
set -g set-clipboard on

set-option -g set-titles on
set-option -g set-titles-string '#S / #W' # Session / Window

# §2. 快捷鍵綁定 (Keybindings)
bind r source-file ~/.tmux.conf \; display "Config Reloaded!"

# 窗格分割 (Pane Splitting)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# 窗格導航 (Pane Navigation) - 無前綴 Alt+Vim鍵 (核心效率)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Pane 大小：Alt+Shift+hjkl
bind -n M-H resize-pane -L 5
bind -n M-J resize-pane -D 5
bind -n M-K resize-pane -U 5
bind -n M-L resize-pane -R 5

# 快速最大化
#bind -n M-z resize-pane -Z

# 視窗導航 (Window Navigation) - 無前綴 Shift+方向鍵 (個人化)
bind -n S-Left  previous-window
bind -n S-Right next-window

# 按鍵轉送 (Key Passthrough) - 用於遙控遠端 Pane (特例)
bind-key -T prefix M-h send-keys M-h
bind-key -T prefix M-j send-keys M-j
bind-key -T prefix M-k send-keys M-k
bind-key -T prefix M-l send-keys M-l

# Ctrl+B → R 進入遠端模式（所有按鍵直通）
bind R \
  set prefix None \;\
  set key-table off \;\
  set status-style "bg=red" \;\
  display 'Remote Mode: Press Ctrl+B to exit'

bind -T off C-q \
  set -u prefix \;\
  set -u key-table \;\
  set -u status-style \;\
  display 'Local Mode'

# 其他實用綁定
bind c new-window -c "#{pane_current_path}"
bind , command-prompt "rename-window %%"

# §3. TPM 外掛管理 (Full Suite)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# 主題 (Primary Theme)
set -g @plugin 'nordtheme/nord-tmux'

# 功能性外掛 (Cockpit needs full restoration)
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'

# 【【【 必須在檔案的最末端！ 】】】
run '~/.tmux/plugins/tpm/tpm'